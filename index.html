<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Expense Tracker with Categories</title>
<style>
*{font-family:Segoe UI;box-sizing:border-box;}
body{
  margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
  background:linear-gradient(135deg,#1d2671,#c33764);transition:0.4s;
}
body.dark{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);}
.container{
  width:480px;background:white;padding:25px;border-radius:18px;
  box-shadow:0 20px 40px rgba(0,0,0,0.3);transition:0.4s;text-align:center;
}
body.dark .container{background:#1e1e1e;color:white;}
input,select,button{
  width:100%;padding:10px;margin:6px 0;border-radius:8px;
}
body.dark input,body.dark select{background:#333;color:white;border:1px solid #555;}
button{border:none;color:white;cursor:pointer;font-size:14px;}
.signup{background:#3F51B5;} .login{background:#009688;}
.add{background:#4CAF50;} .reset{background:#FF9800;}
.export{background:#9C27B0;} .toggle{background:#607D8B;}
.logout{background:#f44336;} .edit{background:#009688;} .del{background:#f44336;}
ul{list-style:none;padding:0;max-height:170px;overflow:auto;}
li{background:#f4f4f4;margin:6px 0;padding:8px;border-radius:6px;
display:flex;justify-content:space-between;align-items:center;}
body.dark li{background:#2f2f2f;}
.actions button{margin-left:5px;padding:5px 8px;font-size:12px;}
canvas{margin-top:15px;}

/* Responsive Landscape & Mobile View */
body {
  flex-direction: column;
  padding: 10px;
}

/* Landscape layout: list + charts side by side */
@media (min-width: 500px) and (orientation: landscape) {
  #app {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
  }

  /* Left side: inputs and expense list */
  #app > input,
  #app > select,
  #app > button,
  #output,
  #list {
    width: 48%;
    margin-right: 2%;
  }

  #list {
    max-height: 300px;
    overflow-y: auto;
  }

  /* Right side: charts side by side */
  #chartsContainer {
    display: flex;
    width: 48%;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  #barChart, #pieChart {
    width: 48%;
    height: auto;
    margin: 10px 0;
  }
}

/* Mobile stacking */
@media (max-width: 500px) {
  #app {
    display: block;
  }
  #app > input,
  #app > select,
  #app > button,
  #output,
  #list,
  #barChart,
  #pieChart {
    width: 100%;
    margin: 5px 0;
  }
  #list {
    max-height: 120px;
  }
  .actions button {
    margin-left: 3px;
    padding: 4px 6px;
    font-size: 10px;
  }
}
</style>
</head>
<body>

<!-- AUTH -->
<div class="container" id="auth">
<h2>üîê Signup / Login</h2>
<input id="su" placeholder="Username">
<input id="sp" type="password" placeholder="Password">
<button class="signup" onclick="signup()">Signup</button>
<button class="login" onclick="login()">Login</button>
<p id="authMsg"></p>
</div>

<!-- APP -->
<div class="container" id="app" style="display:none;">
<h2>üí∞ Expense Tracker</h2>

<input type="number" id="amount" placeholder="Enter amount">
<select id="category">
<option value="" disabled selected>Select category</option>
<option>Food</option>
<option>Transport</option>
<option>Bills</option>
<option>Shopping</option>
<option>Entertainment</option>
<option>Others</option>
</select>
<input type="text" id="customCat" placeholder="Add custom category (optional)">

<button class="add" onclick="addExpense()">Add Expense</button>
<button class="export" onclick="exportExcel()">Export Excel</button>
<button class="toggle" onclick="toggleDark()">Dark Mode</button>
<button class="reset" onclick="resetAll()">Reset All</button>
<button class="logout" onclick="logout()">Logout</button>

<p id="output"></p>
<ul id="list"></ul>

<!-- Charts container -->
<div id="chartsContainer">
<canvas id="barChart" width="400" height="200"></canvas>
<canvas id="pieChart" width="400" height="200"></canvas>
</div>

</div>

<script>
// Users & session
let users = JSON.parse(localStorage.getItem("users"))||{};
let expenses = JSON.parse(localStorage.getItem("expenses"))||[];
let dark = localStorage.getItem("dark")==="true";

if(dark) document.body.classList.add("dark");
if(localStorage.getItem("session")) showApp();

// Signup/Login
function signup(){
  if(su.value && sp.value){
    users[su.value]=sp.value;
    localStorage.setItem("users",JSON.stringify(users));
    authMsg.innerText="Signup successful ‚úÖ";
  }
}
function login(){
  if(users[su.value]===sp.value){
    localStorage.setItem("session",su.value);
    showApp();
  }else authMsg.innerText="Invalid login ‚ùå";
}
function logout(){
  localStorage.removeItem("session");
  location.reload();
}

// App Functions
function showApp(){
  auth.style.display="none";
  app.style.display="block";
  render();
}

function save(){ localStorage.setItem("expenses",JSON.stringify(expenses)); }

function addExpense(){
  let amt=Number(amount.value);
  let cat=customCat.value.trim()||category.value;
  if(!amt || !cat){show("Enter amount and category ‚ùå");return;}
  expenses.push({amt,time:new Date().toLocaleString(),cat});
  save();render();amount.value="";customCat.value="";category.value="";
  show("Expense added ‚úÖ");
}

function editExpense(i){
  let newAmt=prompt("Edit amount:",expenses[i].amt);
  let newCat=prompt("Edit category:",expenses[i].cat);
  if(newAmt && newCat){
    expenses[i].amt=Number(newAmt); expenses[i].cat=newCat;
    save();render(); show("Expense updated ‚úèÔ∏è");
  }
}

function deleteExpense(i){ expenses.splice(i,1); save();render(); show("Expense deleted üóëÔ∏è"); }

function resetAll(){ expenses=[]; save(); render(); show("All expenses cleared üîÑ"); }

function exportExcel(){
  if(expenses.length===0){show("No data ‚ùå");return;}
  let csv="Amount,Category,Time\n";
  expenses.forEach(e=>csv+=`${e.amt},${e.cat},${e.time}\n`);
  let a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([csv]));
  a.download="expenses.csv"; a.click();
}

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}

// Render list + charts
function render(){
  list.innerHTML="";
  expenses.forEach((e,i)=>{
    list.innerHTML+=`<li>
      ‚Çπ${e.amt} - ${e.cat}<br><small>${e.time}</small>
      <div class="actions">
        <button class="edit" onclick="editExpense(${i})">‚úèÔ∏è</button>
        <button class="del" onclick="deleteExpense(${i})">‚ùå</button>
      </div>
    </li>`;
  });
  drawBarChart(); drawPieChart();
  show(`Total: ‚Çπ${expenses.reduce((s,e)=>s+e.amt,0)}`);
}

// Charts
function drawBarChart(){
  let c=document.getElementById("barChart"); let ctx=c.getContext("2d");
  ctx.clearRect(0,0,c.width,c.height);

  // category colors matching pie chart
  let catColors={"Food":"#4CAF50","Transport":"#2196F3","Bills":"#FF9800","Shopping":"#9C27B0","Entertainment":"#607D8B","Others":"#f44336"};
  let max=Math.max(...expenses.map(e=>e.amt),1);
  expenses.forEach((e,i)=>{
    let h=(e.amt/max)*150;
    ctx.fillStyle=catColors[e.cat] || "#009688";
    ctx.fillRect(i*40+20,180-h,30,h);
    ctx.fillStyle="black"; ctx.fillText(e.amt,i*40+20,180-h-5);
  });
}

function drawPieChart(){
  let c=document.getElementById("pieChart"); let ctx=c.getContext("2d"); ctx.clearRect(0,0,c.width,c.height);
  let catTotals={};
  expenses.forEach(e=>catTotals[e.cat]=(catTotals[e.cat]||0)+e.amt);
  let total=Object.values(catTotals).reduce((a,b)=>a+b,0);
  let start=0; 
  let colors={"Food":"#4CAF50","Transport":"#2196F3","Bills":"#FF9800","Shopping":"#9C27B0","Entertainment":"#607D8B","Others":"#f44336"};
  for(let cat in catTotals){
    let slice=(catTotals[cat]/total)*2*Math.PI;
    ctx.beginPath(); ctx.moveTo(200,100);
    ctx.fillStyle=colors[cat] || "#009688";
    ctx.arc(200,100,80,start,start+slice);
    ctx.fill(); start+=slice;
  }
}

// Show message
function show(msg){output.innerText=msg;}
</script>
</body>
</html>
